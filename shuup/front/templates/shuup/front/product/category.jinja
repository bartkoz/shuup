{% if request.is_ajax() %}
    {%- import "shuup/front/macros/general.jinja" as macros with context -%}
    {%- import "shuup/front/macros/category.jinja" as category_macros with context -%}
    {{ category_macros.render_product_list(supplier) }}
{% else %}
    {% extends "shuup/front/base.jinja" %}
    {% block extracss %}
        <style>
            .centered {
              display: flex;
              align-items: center;
              justify-content: center;
            }
            .lds-default {
              display: inline-block;
              position: relative;
              width: 80px;
              height: 80px;
            }
            .lds-default div {
              position: absolute;
              width: 6px;
              height: 6px;
              background: #fff;
              border-radius: 50%;
              background-color: #007dbc;
              animation: lds-default 1.2s linear infinite;
            }
            .lds-default div:nth-child(1) {
              animation-delay: 0s;
              top: 37px;
              left: 66px;
            }
            .lds-default div:nth-child(2) {
              animation-delay: -0.1s;
              top: 22px;
              left: 62px;
            }
            .lds-default div:nth-child(3) {
              animation-delay: -0.2s;
              top: 11px;
              left: 52px;
            }
            .lds-default div:nth-child(4) {
              animation-delay: -0.3s;
              top: 7px;
              left: 37px;
            }
            .lds-default div:nth-child(5) {
              animation-delay: -0.4s;
              top: 11px;
              left: 22px;
            }
            .lds-default div:nth-child(6) {
              animation-delay: -0.5s;
              top: 22px;
              left: 11px;
            }
            .lds-default div:nth-child(7) {
              animation-delay: -0.6s;
              top: 37px;
              left: 7px;
            }
            .lds-default div:nth-child(8) {
              animation-delay: -0.7s;
              top: 52px;
              left: 11px;
            }
            .lds-default div:nth-child(9) {
              animation-delay: -0.8s;
              top: 62px;
              left: 22px;
            }
            .lds-default div:nth-child(10) {
              animation-delay: -0.9s;
              top: 66px;
              left: 37px;
            }
            .lds-default div:nth-child(11) {
              animation-delay: -1s;
              top: 62px;
              left: 52px;
            }
            .lds-default div:nth-child(12) {
              animation-delay: -1.1s;
              top: 52px;
              left: 62px;
            }
            @keyframes lds-default {
              0%, 20%, 80%, 100% {
                transform: scale(1);
              }
              50% {
                transform: scale(1.5);
              }
            }
        </style>
    {% endblock %}
    {% block extrameta %}
    {% if category %}
        {{ macros.render_metadata(category, category.name, category.description, "category") }}
    {% endif %}
    {% endblock %}
    {% block title %}{{ (category.name if category else _("Categories")) }}{% endblock %}

    {% block content_title %}{{ (category.name if category else "") }}{% endblock %}

    {% block breadcrumb %}
        {% if category %}
            {% call macros.breadcrumb() %}
                {{ macros.render_breadcrumb_item("/", _("Home")) }}
                {% for c in category.get_ancestors() if c.is_visible(customer=request.customer) %}
                    {{ macros.render_breadcrumb_item(shuup.urls.model_url(c), c.name) }}
                {% endfor %}
                {{ macros.render_breadcrumb_item(None, category.name, True) }}
            {% endcall %}
        {% endif %}
    {% endblock %}

    {% block content %}
        {% placeholder "category_top" %}{% endplaceholder %}
        <script>window.PRODUCT_LIST_FILTERS = {{ form.fields.keys()|list|json }};</script>
        {{ category_macros.render_information() }}
        {{ category_macros.render_products_section(supplier) }}
    {% endblock %}
{% endif %}

{% block extrajs %}
    {{ category_macros.render_extrajs() }}
    <script>
        ajax_content = document.getElementById('ajax_content')
        dataLayer.push({'event': 'pageview', 'pageDomain': 'sklep.fishster.pl', 'pageURL': '/c/{{ object.pk }}-{{ object.slug }}/', 'pageType': 'listing'});
        function loadProductsAsync(url) {
            showLoader()
            $.get(url, function (data, status) {
                ajax_content.innerHTML = data
            });
        }
        loadProductsAsync("{{ request.get_full_path() }}")
        function showLoader(){
            ajax_content.innerHTML = '<div class="centered"><div class="lds-default"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>';
        }
    </script>
{% endblock %}
